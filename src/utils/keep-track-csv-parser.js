import moment from "moment";

import type { LineData } from "flow-types";

export const fileAsString = `Trackers

alert/tired (1-10)
18/05/2019,15:10,4.9
18/05/2019,12:00,4.9
18/05/2019,07:00,4.95
17/05/2019,20:00,4.6
17/05/2019,12:00,5
17/05/2019,07:00,4.8
16/05/2019,20:00,5
16/05/2019,12:00,5
16/05/2019,07:00,4.75
15/05/2019,20:04,4.95
15/05/2019,07:00,4.6
14/05/2019,20:04,4.7
14/05/2019,12:14,5
14/05/2019,07:00,4.7
13/05/2019,20:00,4.95
13/05/2019,12:00,5.2
13/05/2019,07:00,5
12/05/2019,20:00,5.2
12/05/2019,12:00,5.2
12/05/2019,07:00,5.2
11/05/2019,20:04,5
11/05/2019,12:00,5
11/05/2019,07:00,4.8
10/05/2019,20:04,4.6
10/05/2019,12:00,5.3
10/05/2019,07:04,4.9

feel good 1-10
18/05/2019,15:11,5.1
18/05/2019,12:00,5.15
18/05/2019,07:00,5
17/05/2019,20:00,5.1
17/05/2019,12:00,5.2
17/05/2019,07:00,4.75
16/05/2019,20:00,5.1
16/05/2019,12:00,4.7
16/05/2019,07:00,4.75
15/05/2019,20:04,4.8
15/05/2019,12:00,4.9
15/05/2019,07:00,4.8
14/05/2019,20:04,4.9
14/05/2019,12:00,4.8
14/05/2019,07:00,4.8
13/05/2019,20:00,4.95
13/05/2019,12:00,5
13/05/2019,07:00,4.7
12/05/2019,20:00,4.8
12/05/2019,15:58,4.8
12/05/2019,07:00,4.9
11/05/2019,20:04,4.75
11/05/2019,12:00,4.9
11/05/2019,07:00,4.8
10/05/2019,20:04,5
10/05/2019,12:00,5
10/05/2019,07:04,4.8
`;

type ReturnValue = [{ name: string, data: LineData }];

export const keepTrackCsvParser = (csv: string): ReturnValue => {
  // Ignore the first part
  let statsLeftToParse = csv.split("\n\n");
  statsLeftToParse = statsLeftToParse.slice(1);

  return statsLeftToParse.map(stats => {
    const lines = stats.split("\n");
    const name = lines[0];
    const data = lines.slice(1).map(line => {
      const vals = line.split(",");
      const x = moment(`${vals[0]} ${vals[1]}`, "DD/MM/YYYY HH:mm");
      const y = parseFloat(vals[2]);
      return { x, y };
    });
    return { name, data };
  });
};
